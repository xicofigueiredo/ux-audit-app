<%# Static demo page - all data hardcoded from VideoAudit #3 %>

<%
  # Static demo data - no database dependency
  demo_audit_id = 3
  demo_audit = {
    "workflowSummary" => {
      "workflowtitle" => "Speech Improvement Workflow",
      "userGoal" => "The user aims to improve speech by reducing filler words through guided exercises.",
      "workflowSteps" => [
        "Accessing the dashboard",
        "Viewing issues and recommendations",
        "Engaging in a practice drill",
        "Recording and reviewing progress"
      ],
      "workflowCriticality" => "Standard"
    },
    "identifiedIssues" => [
      {
        "frameReference" => "Frames 21-23",
        "painPointTitle" => "Lack of Contextual Guidance",
        "severity" => "Medium",
        "issueDescription" => "This violates Nielsen's Heuristic #7: Flexibility and efficiency of use. The screen displays filler word issues but lacks contextual guidance or examples, making it difficult to understand how to improve.",
        "recommendations" => [
          "Include contextual examples of correct versus incorrect usage for each identified issue.",
          "Provide tooltips or info buttons that explain the impact of specific filler words on speech quality."
        ],
        "heuristicViolated" => "Nielsen's Heuristic #7: Flexibility and efficiency of use"
      },
      {
        "frameReference" => "Frames 24-26",
        "painPointTitle" => "Inconsistent Visual Feedback",
        "severity" => "Low",
        "issueDescription" => "Conflicts with Shneiderman's Golden Rule of consistency. The 'Start 30s Drill' button appears identical in multiple frames, whether or not it has been interacted with.",
        "recommendations" => [
          "Change the button color or label once clicked to indicate engagement and progress visually.",
          "Provide a subtle animation or progress indicator during the drill to convey activity."
        ],
        "heuristicViolated" => "Shneiderman's Golden Rule of consistency"
      },
      {
        "frameReference" => "Frames 27-29",
        "painPointTitle" => "Redundant Navigation Elements",
        "severity" => "Medium",
        "issueDescription" => "Violates Nielsen's Heuristic #8: Aesthetic and minimalist design. The navigation elements are repeated unnecessarily across similar sections, cluttering the interface.",
        "recommendations" => [
          "Consolidate navigation elements to a single location to reduce repetition.",
          "Use collapsible menus or tabs to streamline access to different features."
        ],
        "heuristicViolated" => "Nielsen's Heuristic #8: Aesthetic and minimalist design"
      },
      {
        "frameReference" => "Frames 30-34",
        "painPointTitle" => "Confusing Metrics Presentation",
        "severity" => "High",
        "issueDescription" => "This violates Nielsen's Heuristic #6: Recognition rather than recall. The metrics for 'Filler Words' and 'Pace' are not clearly defined or explained, leading to user confusion about what these metrics indicate.",
        "recommendations" => [
          "Add explanations or hover-over tooltips for each metric to outline its significance and method of calculation.",
          "Provide a quick guide or help section detailing how users can interpret and improve these metrics."
        ],
        "heuristicViolated" => "Nielsen's Heuristic #6: Recognition rather than recall"
      }
    ]
  }

  # Helper methods for demo page
  def demo_frame_range_to_time(frame_ref)
    return "" unless frame_ref
    frames = frame_ref.scan(/\d+/).map(&:to_i)
    return "" if frames.empty?

    start_frame = frames[0]
    end_frame = frames[1] || start_frame

    # Assuming 30 fps
    fps = 30.0
    start_seconds = (start_frame / fps).round(1)
    end_seconds = (end_frame / fps).round(1)

    if start_seconds == end_seconds
      "#{start_seconds}s"
    else
      "#{start_seconds}s - #{end_seconds}s"
    end
  end

  def demo_generate_issue_id(audit_id, idx)
    prefix = ["DXN", "OXN", "PXN", "QXN"].sample
    audit_part = audit_id.to_s.rjust(3, '0')
    issue_part = (idx + 1).to_s.rjust(3, '0')
    "#{prefix}-#{audit_part}-#{issue_part}"
  end

  def demo_extract_heuristic_label(heuristic)
    return heuristic unless heuristic
    heuristic.split(':').first.strip
  end

  def demo_extract_evidence(description)
    return description unless description
    # Extract the evidence portion (everything after the first sentence about the heuristic)
    parts = description.split('. ', 2)
    parts.length > 1 ? parts[1] : description
  end

  # Calculate severity stats
  issues = demo_audit["identifiedIssues"]
  stats = {
    total: issues.count,
    high: issues.count { |i| i["severity"].downcase == "high" },
    medium: issues.count { |i| i["severity"].downcase == "medium" },
    low: issues.count { |i| i["severity"].downcase == "low" }
  }
%>

<div class="analysis-app-container">
  <!-- Header -->
  <header class="analysis-header">
    <div class="header-left">
      <a href="/" class="back-link">&larr; Back</a>
      <h1 class="report-title">Workflow Report</h1>
    </div>
    <div class="header-right">
      <span class="demo-badge">Demo</span>
      <button class="filter-btn" id="filter-btn">
        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
        </svg>
        Filters
      </button>
      <button class="export-btn" id="export-btn">
        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
        </svg>
        Export
      </button>
    </div>
  </header>

  <!-- Demo CTA Banner -->
  <div class="demo-banner">
    <div class="demo-banner-content">
      <div class="demo-banner-text">
        <h3>ðŸ‘‹ This is a demo analysis</h3>
        <p>See how UX Audit App identifies issues and provides actionable recommendations. Sign up to analyze your own workflows!</p>
      </div>
      <div class="demo-banner-actions">
        <%= link_to "Sign Up Free", new_user_registration_path, class: "cta-button primary" %>
        <%= link_to "Learn More", root_path + "#how-it-works", class: "cta-button secondary" %>
      </div>
    </div>
  </div>

  <!-- Summary Statistics Cards -->
  <div class="summary-stats-container">
    <div class="stat-card total">
      <div class="stat-label">Total Issues</div>
      <div class="stat-value"><%= stats[:total] %></div>
    </div>
    <div class="stat-card high-severity">
      <div class="stat-label">
        High Severity
        <button class="severity-info-icon" data-severity="high" data-tooltip="Blocks critical tasks - Fix this week - Click for more info" aria-label="Information about High severity">
          <svg width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
            <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-width="1.5" fill="none"/>
            <text x="8" y="11" text-anchor="middle" font-size="10" font-weight="bold" fill="currentColor">i</text>
          </svg>
        </button>
      </div>
      <div class="stat-value high"><%= stats[:high] %></div>
    </div>
    <div class="stat-card medium-severity">
      <div class="stat-label">
        Medium
        <button class="severity-info-icon" data-severity="medium" data-tooltip="Causes friction - Fix this month - Click for more info" aria-label="Information about Medium severity">
          <svg width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
            <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-width="1.5" fill="none"/>
            <text x="8" y="11" text-anchor="middle" font-size="10" font-weight="bold" fill="currentColor">i</text>
          </svg>
        </button>
      </div>
      <div class="stat-value medium"><%= stats[:medium] %></div>
    </div>
    <div class="stat-card low-severity">
      <div class="stat-label">
        Low
        <button class="severity-info-icon" data-severity="low" data-tooltip="Polish issue - Fix when you have time - Click for more info" aria-label="Information about Low severity">
          <svg width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
            <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-width="1.5" fill="none"/>
            <text x="8" y="11" text-anchor="middle" font-size="10" font-weight="bold" fill="currentColor">i</text>
          </svg>
        </button>
      </div>
      <div class="stat-value low"><%= stats[:low] %></div>
    </div>

    <!-- Timeline Bar - Full Width -->
    <div class="timeline-bar-container">
      <h4 class="timeline-heading">Timeline</h4>
      <div class="timeline-ranges">
        <% demo_audit["identifiedIssues"].each_with_index do |issue, idx| %>
          <% if issue["frameReference"] %>
            <button class="timeline-range-btn" data-issue-index="<%= idx %>">
              <svg width="10" height="10" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="margin-right: 3px;">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
              <%= demo_frame_range_to_time(issue["frameReference"]) %>
            </button>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Workflow Analysis - Separate Collapsible Section -->
  <div class="workflow-analysis-section">
    <button class="workflow-toggle-btn" id="workflow-toggle-btn">
      <span class="workflow-title"><%= demo_audit["workflowSummary"]["workflowtitle"] || "Workflow Analysis" %></span>
      <svg class="chevron-workflow" width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
      </svg>
    </button>
    <div class="workflow-details collapsed" id="workflow-details">
      <div class="workflow-goal">
        <strong>User Goal:</strong> <%= demo_audit["workflowSummary"]["userGoal"] %>
      </div>
      <div class="workflow-steps">
        <strong>Steps:</strong>
        <ol class="workflow-steps-list-compact">
          <% demo_audit["workflowSummary"]["workflowSteps"].each do |step| %>
            <li><%= step %></li>
          <% end %>
        </ol>
      </div>
    </div>
  </div>

  <div class="analysis-body">
    <!-- Main Content Area -->
    <main class="analysis-main">
      <div class="tab-content overview-tab active">
        <div class="issue-card-grid">
          <% demo_audit["identifiedIssues"].each_with_index do |issue, idx| %>
            <div class="issue-card" id="issue-card-<%= idx %>">
              <!-- Issue ID and Title with Severity -->
              <div class="issue-card-header">
                <div class="issue-id-title">
                  <span class="issue-id">[<%= demo_generate_issue_id(demo_audit_id, idx) %>]</span>
                  <h3 class="issue-title"><%= issue["painPointTitle"] %></h3>
                </div>
                <span class="issue-severity <%= issue["severity"].downcase %>">
                  <%= issue["severity"].capitalize %>
                </span>
              </div>

              <!-- Heuristic Reference -->
              <% if issue["heuristicViolated"].present? %>
                <div class="issue-heuristic">
                  Heuristic: <%= demo_extract_heuristic_label(issue["heuristicViolated"]) %>
                </div>
              <% end %>

              <!-- Time -->
              <% if issue["frameReference"] %>
                <div class="issue-time">
                  <svg width="12" height="12" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                    <path d="M6.271 5.055a.5.5 0 0 1 .52.038l3.5 2.5a.5.5 0 0 1 0 .814l-3.5 2.5A.5.5 0 0 1 6 10.5v-5a.5.5 0 0 1 .271-.445z"/>
                  </svg>
                  <span class="time-label">Time:</span>
                  <span class="time-value"><%= demo_frame_range_to_time(issue["frameReference"]) %></span>
                </div>
              <% end %>

              <!-- Evidence Section -->
              <div class="issue-evidence">
                <strong>Evidence:</strong>
                <%= demo_extract_evidence(issue["issueDescription"]) %>
              </div>

              <!-- Recommendations -->
              <div class="issue-recommendations">
                <strong>Recommendations:</strong>
                <ul>
                  <% issue["recommendations"].each do |rec| %>
                    <li><%= rec %></li>
                  <% end %>
                </ul>
              </div>

              <!-- Card Actions -->
              <div class="issue-card-actions">
                <button class="copy-btn demo-disabled">
                  <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="margin-right: 4px;">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                  </svg>
                  Copy
                </button>
                <button class="jira-btn demo-disabled">
                  <svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24" style="margin-right: 4px;">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 14H9v-2h2v2zm0-4H9V7h2v5z"></path>
                  </svg>
                  Jira
                </button>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </main>
  </div>

  <!-- Bottom CTA -->
  <div class="demo-bottom-cta">
    <div class="demo-cta-content">
      <h3>Ready to analyze your own workflows?</h3>
      <p>Upload your screen recordings and get detailed UX insights in minutes</p>
      <%= link_to "Get Started Free", new_user_registration_path, class: "cta-button primary large" %>
    </div>
  </div>

  <!-- Severity Info Modal -->
  <div id="severityModal" class="severity-modal" style="display: none;">
    <div class="severity-modal-content">
      <button class="severity-modal-close" aria-label="Close modal">&times;</button>
      <div id="severityModalBody"></div>
    </div>
  </div>
</div>

<style>
.analysis-app-container {
  font-family: 'Inter', sans-serif;
  background: #f9fafb;
  min-height: 100vh;
}
.analysis-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 40px 10px 40px;
  background: #fff;
  border-bottom: 1px solid #e5e7eb;
}
.header-left {
  display: flex;
  align-items: center;
  gap: 24px;
}
.back-link {
  color: #6366f1;
  text-decoration: none;
  font-weight: 500;
  transition: color 0.2s;
}
.back-link:hover {
  color: #4f46e5;
}
.report-title {
  font-size: 1.25rem;
  font-weight: 600;
  color: #1e293b;
  margin: 0;
}
.header-right {
  display: flex;
  align-items: center;
  gap: 12px;
}
.demo-badge {
  background: linear-gradient(45deg, #6366f1, #8b5cf6);
  color: white;
  padding: 6px 14px;
  border-radius: 20px;
  font-weight: 600;
  font-size: 0.9rem;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
.filter-btn, .export-btn {
  background: #fff;
  border: 1px solid #e5e7eb;
  border-radius: 6px;
  padding: 6px 12px;
  font-weight: 500;
  font-size: 0.85rem;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 4px;
  color: #374151;
  transition: all 0.2s;
}
.filter-btn:hover, .export-btn:hover {
  background: #f9fafb;
  border-color: #d1d5db;
}

/* Demo Banner */
.demo-banner {
  background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
  color: white;
  padding: 24px 40px;
}
.demo-banner-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
  max-width: 1200px;
  margin: 0 auto;
}
.demo-banner-text h3 {
  margin: 0 0 8px 0;
  font-size: 1.3rem;
  font-weight: 700;
}
.demo-banner-text p {
  margin: 0;
  font-size: 1rem;
  opacity: 0.9;
}
.demo-banner-actions {
  display: flex;
  gap: 12px;
}
.cta-button {
  padding: 12px 24px;
  border-radius: 8px;
  font-weight: 600;
  text-decoration: none;
  transition: all 0.2s;
  white-space: nowrap;
}
.cta-button.primary {
  background: white;
  color: #6366f1;
}
.cta-button.primary:hover {
  background: #f8fafc;
  transform: translateY(-1px);
}
.cta-button.secondary {
  background: rgba(255, 255, 255, 0.15);
  color: white;
  border: 1px solid rgba(255, 255, 255, 0.3);
}
.cta-button.secondary:hover {
  background: rgba(255, 255, 255, 0.25);
}
.cta-button.large {
  padding: 16px 32px;
  font-size: 1.1rem;
}

/* Summary Statistics Cards */
.summary-stats-container {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 12px;
  padding: 16px 40px 12px 40px;
  background: #f9fafb;
  border-bottom: 1px solid #e5e7eb;
}
.stat-card {
  background: #fff;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  padding: 10px 14px;
  text-align: left;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
}
.stat-label {
  font-size: 0.8rem;
  color: #6b7280;
  font-weight: 500;
  display: flex;
  align-items: center;
}
.stat-value {
  font-size: 1.5rem;
  font-weight: 700;
  color: #1e293b;
  flex-shrink: 0;
}
.stat-card.total .stat-value {
  color: #6366f1;
  font-weight: 800;
}
.stat-value.high { color: #dc2626; }
.stat-value.medium { color: #f59e0b; }
.stat-value.low { color: #2563eb; }

/* Timeline Bar - Full Width */
.timeline-bar-container {
  grid-column: 1 / -1;
  background: #fff;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  padding: 12px 16px;
  margin-top: 4px;
}

.timeline-heading {
  font-size: 0.8rem;
  font-weight: 600;
  color: #1e293b;
  margin: 0 0 8px 0;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.timeline-ranges {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  align-items: center;
}

.timeline-range-btn {
  background: #f9fafb;
  border: 1px solid #e5e7eb;
  border-radius: 4px;
  padding: 4px 10px;
  font-size: 0.75rem;
  font-weight: 500;
  color: #374151;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  font-family: monospace;
}

.timeline-range-btn:hover {
  background: #eff6ff;
  border-color: #bfdbfe;
  color: #2563eb;
}

.timeline-range-btn svg {
  transition: transform 0.2s;
}

.timeline-range-btn:hover svg {
  transform: translateX(2px);
}

/* Workflow Analysis Section */
.workflow-analysis-section {
  background: #fff;
  padding: 12px 40px;
  border-bottom: 1px solid #e5e7eb;
}

.workflow-toggle-btn {
  background: #f9fafb;
  border: 1px solid #e5e7eb;
  border-radius: 6px;
  padding: 10px 16px;
  font-size: 0.9rem;
  font-weight: 600;
  color: #1e293b;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  gap: 10px;
  width: 100%;
  justify-content: space-between;
}

.workflow-toggle-btn:hover {
  background: #f3f4f6;
  border-color: #d1d5db;
}

.workflow-title {
  font-size: 0.9rem;
  color: #1e293b;
  font-weight: 600;
}

.chevron-workflow {
  transition: transform 0.3s ease;
  flex-shrink: 0;
}

.workflow-details {
  overflow: hidden;
  transition: max-height 0.4s ease, opacity 0.4s ease, padding 0.4s ease;
  background: #f9fafb;
  border-radius: 6px;
}

.workflow-details.collapsed {
  max-height: 0;
  opacity: 0;
  padding: 0 16px;
}

.workflow-details.expanded {
  max-height: 600px;
  opacity: 1;
  padding: 16px;
  margin-top: 10px;
}

.workflow-goal {
  font-size: 0.85rem;
  color: #374151;
  margin-bottom: 12px;
  line-height: 1.6;
}

.workflow-goal strong {
  color: #1e293b;
  font-weight: 600;
}

.workflow-steps {
  font-size: 0.85rem;
  color: #374151;
}

.workflow-steps strong {
  color: #1e293b;
  font-weight: 600;
  display: block;
  margin-bottom: 8px;
}

.workflow-steps-list-compact {
  margin: 0 0 0 20px;
  padding: 0;
  font-size: 0.85rem;
  color: #374151;
  line-height: 1.6;
}

.workflow-steps-list-compact li {
  margin-bottom: 6px;
}

.analysis-body {
  background: #f9fafb;
}

.analysis-main {
  width: 100%;
  max-width: 1400px;
  margin: 0 auto;
  padding: 32px 40px;
}

.issue-card-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 24px;
  margin-top: 0;
}
@media (max-width: 1200px) {
  .issue-card-grid {
    grid-template-columns: 1fr;
  }
}
.issue-card {
  background: #fff;
  border: 1px solid #e5e7eb;
  border-radius: 12px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.05);
  padding: 20px;
  display: flex;
  flex-direction: column;
  transition: all 0.2s;
}
.issue-card:hover {
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  border-color: #d1d5db;
}
.issue-card.highlighted {
  border: 2px solid #6366f1;
  box-shadow: 0 0 0 2px #6366f1;
}
.issue-card-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 10px;
  gap: 12px;
}
.issue-id-title {
  flex: 1;
}
.issue-id {
  font-size: 0.75rem;
  font-weight: 400;
  color: #9ca3af;
  display: block;
  margin-bottom: 8px;
}
.issue-title {
  font-size: 1.1rem;
  font-weight: 700;
  color: #111827;
  margin: 0;
  line-height: 1.4;
}
.issue-severity {
  font-size: 0.8rem;
  font-weight: 600;
  border-radius: 12px;
  padding: 4px 12px;
  text-transform: capitalize;
  white-space: nowrap;
  flex-shrink: 0;
}
.issue-severity.high { background: #fee2e2; color: #dc2626; }
.issue-severity.medium { background: #fef3c7; color: #d97706; }
.issue-severity.low { background: #dbeafe; color: #2563eb; }
.issue-heuristic {
  color: #9ca3af;
  font-size: 0.8rem;
  margin-bottom: 12px;
  font-weight: 400;
}
.issue-time {
  color: #374151;
  font-size: 0.9rem;
  margin-bottom: 12px;
  display: flex;
  align-items: center;
  gap: 4px;
}
.issue-time .time-label {
  font-weight: 600;
}
.issue-time .time-value {
  font-weight: 400;
}
.issue-evidence {
  color: #374151;
  margin-bottom: 14px;
  font-size: 0.9rem;
  line-height: 1.6;
  font-weight: 400;
}
.issue-evidence strong {
  color: #111827;
  display: block;
  margin-bottom: 6px;
  font-size: 0.9rem;
  font-weight: 600;
}
.issue-recommendations {
  margin-bottom: 16px;
  font-size: 0.9rem;
  flex: 1;
}
.issue-recommendations strong {
  color: #111827;
  display: block;
  margin-bottom: 8px;
  font-size: 0.9rem;
  font-weight: 600;
}
.issue-recommendations ul {
  margin: 0;
  padding-left: 18px;
}
.issue-recommendations li {
  margin-bottom: 4px;
  color: #374151;
  line-height: 1.6;
  font-weight: 400;
}
.issue-card-actions {
  margin-top: auto;
  display: flex;
  gap: 8px;
}
.copy-btn, .jira-btn {
  background: #fff;
  border: 1px solid #e5e7eb;
  border-radius: 6px;
  padding: 8px 14px;
  font-weight: 500;
  cursor: pointer;
  color: #374151;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  font-size: 0.85rem;
}
.copy-btn.demo-disabled, .jira-btn.demo-disabled {
  opacity: 0.6;
  cursor: not-allowed;
}
.copy-btn:not(.demo-disabled):hover {
  background: #f9fafb;
  border-color: #d1d5db;
}
.jira-btn:not(.demo-disabled):hover {
  background: #eff6ff;
  border-color: #bfdbfe;
  color: #2563eb;
}

/* Bottom CTA */
.demo-bottom-cta {
  background: #fff;
  border-top: 1px solid #e5e7eb;
  padding: 48px 40px;
  text-align: center;
}
.demo-cta-content h3 {
  margin: 0 0 12px 0;
  font-size: 1.75rem;
  font-weight: 700;
  color: #1e293b;
}
.demo-cta-content p {
  margin: 0 0 24px 0;
  font-size: 1.1rem;
  color: #6b7280;
}

/* Severity Info Icon */
.severity-info-icon {
  background: none;
  border: none;
  cursor: pointer;
  padding: 0;
  margin-left: 4px;
  color: #9ca3af;
  transition: color 0.2s, transform 0.2s;
  vertical-align: middle;
  display: inline-flex;
  align-items: center;
  width: 14px;
  height: 14px;
  position: relative;
}

.severity-info-icon:hover {
  color: #6366f1;
  transform: scale(1.15);
}

.severity-info-icon:focus {
  outline: 2px solid #6366f1;
  outline-offset: 2px;
  border-radius: 50%;
}

.severity-info-icon svg {
  width: 14px;
  height: 14px;
}

/* Severity Tooltip on Hover */
.severity-info-icon::after {
  content: attr(data-tooltip);
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%) translateY(-8px);
  background: #1f2937;
  color: white;
  padding: 8px 12px;
  border-radius: 6px;
  font-size: 0.75rem;
  font-weight: 500;
  white-space: nowrap;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s, transform 0.2s;
  z-index: 1000;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.severity-info-icon::before {
  content: '';
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%) translateY(-2px);
  border: 5px solid transparent;
  border-top-color: #1f2937;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s, transform 0.2s;
  z-index: 1000;
}

.severity-info-icon:hover::after,
.severity-info-icon:hover::before {
  opacity: 1;
  transform: translateX(-50%) translateY(-4px);
}

.severity-info-icon:hover::before {
  transform: translateX(-50%) translateY(1px);
}

/* Severity Modal */
.severity-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  animation: fadeIn 0.2s ease;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.severity-modal-content {
  background: white;
  border-radius: 12px;
  max-width: 600px;
  width: 90%;
  max-height: 80vh;
  overflow-y: auto;
  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
  position: relative;
  padding: 32px;
  animation: slideUp 0.3s ease;
}

@keyframes slideUp {
  from {
    transform: translateY(20px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

.severity-modal-close {
  position: absolute;
  top: 16px;
  right: 16px;
  background: none;
  border: none;
  font-size: 28px;
  color: #9ca3af;
  cursor: pointer;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 4px;
  transition: background 0.2s, color 0.2s;
  line-height: 1;
}

.severity-modal-close:hover {
  background: #f3f4f6;
  color: #374151;
}

#severityModalBody h2 {
  margin: 0 0 24px 0;
  font-size: 1.75rem;
  font-weight: 700;
  color: #111827;
  display: flex;
  align-items: center;
  gap: 12px;
}

#severityModalBody .severity-icon {
  font-size: 2rem;
}

#severityModalBody .severity-section {
  margin-bottom: 24px;
}

#severityModalBody .severity-section h3 {
  margin: 0 0 8px 0;
  font-size: 1.1rem;
  font-weight: 600;
  color: #374151;
}

#severityModalBody .severity-section p {
  margin: 0 0 12px 0;
  font-size: 1rem;
  line-height: 1.6;
  color: #6b7280;
}

#severityModalBody .severity-examples {
  background: #f9fafb;
  border-left: 3px solid #e5e7eb;
  padding: 12px 16px;
  border-radius: 4px;
}

#severityModalBody .severity-examples ul {
  margin: 8px 0 0 0;
  padding-left: 20px;
}

#severityModalBody .severity-examples li {
  margin-bottom: 6px;
  color: #374151;
  line-height: 1.5;
}

#severityModalBody .severity-timeline {
  background: #eff6ff;
  border-left: 3px solid #3b82f6;
  padding: 12px 16px;
  border-radius: 4px;
  font-weight: 600;
  color: #1e40af;
}

#severityModalBody .severity-calculation {
  background: #f0fdf4;
  border-left: 3px solid #22c55e;
  padding: 12px 16px;
  border-radius: 4px;
  font-size: 0.95rem;
  color: #166534;
  line-height: 1.6;
}

#severityModalBody .workflow-context {
  background: #fef3c7;
  border-left: 3px solid #f59e0b;
  padding: 12px 16px;
  border-radius: 4px;
  margin-top: 16px;
}

#severityModalBody .workflow-context strong {
  color: #92400e;
}

/* Mobile Responsive */
@media (max-width: 768px) {
  .analysis-header {
    padding: 16px 20px 12px 20px;
    flex-direction: column;
    align-items: flex-start;
    gap: 16px;
  }

  .header-left {
    gap: 12px;
  }

  .report-title {
    font-size: 1.4rem;
  }

  .header-right {
    width: 100%;
    justify-content: flex-end;
  }

  .demo-banner {
    padding: 20px 16px;
  }

  .demo-banner-content {
    flex-direction: column;
    gap: 16px;
    text-align: center;
  }

  .demo-banner-actions {
    justify-content: center;
  }

  .summary-stats-container {
    grid-template-columns: repeat(2, 1fr);
    padding: 12px 20px;
    gap: 10px;
  }

  .stat-value {
    font-size: 1.5rem;
  }

  .timeline-bar-container {
    padding: 10px 12px;
  }

  .timeline-heading {
    font-size: 0.75rem;
    margin-bottom: 6px;
  }

  .timeline-ranges {
    gap: 6px;
  }

  .timeline-range-btn {
    padding: 4px 8px;
    font-size: 0.7rem;
  }

  .workflow-analysis-section {
    padding: 10px 20px;
  }

  .workflow-toggle-btn {
    padding: 8px 12px;
    font-size: 0.85rem;
  }

  .analysis-main {
    padding: 20px 16px;
  }

  .issue-card-grid {
    grid-template-columns: 1fr;
    gap: 20px;
  }

  .issue-card {
    padding: 20px 16px;
  }

  .demo-bottom-cta {
    padding: 32px 16px;
  }

  .severity-modal-content {
    width: 95%;
    padding: 24px 20px;
    max-height: 90vh;
  }

  #severityModalBody h2 {
    font-size: 1.5rem;
  }
}
</style>

<script>
// Toggle workflow details
function toggleWorkflowDetails() {
  const details = document.getElementById('workflow-details');
  const chevron = document.querySelector('.chevron-workflow');

  if (details.classList.contains('collapsed')) {
    details.classList.remove('collapsed');
    details.classList.add('expanded');
    chevron.style.transform = 'rotate(180deg)';
  } else {
    details.classList.remove('expanded');
    details.classList.add('collapsed');
    chevron.style.transform = 'rotate(0deg)';
  }
}

// Highlight feedback card when timeline step is clicked
function highlightCard(idx) {
  const cards = document.querySelectorAll('.issue-card');
  cards.forEach((card, i) => {
    card.classList.remove('highlighted');
    if (idx === 'all' || idx === undefined) {
      card.style.display = '';
    } else if (i === idx) {
      card.classList.add('highlighted');
      card.scrollIntoView({ behavior: 'smooth', block: 'center' });
      card.style.display = '';
    } else {
      card.style.display = 'none';
    }
  });
}

// Severity Info Modal Functions
function openSeverityInfo(severity) {
  const modal = document.getElementById('severityModal');
  const modalBody = document.getElementById('severityModalBody');

  const workflowCriticality = 'Standard';
  const workflowTitle = 'Speech Improvement Workflow';

  const severityContent = {
    high: {
      icon: 'ðŸ”´',
      title: 'High Severity',
      definition: 'This issue is actively preventing users from completing important tasks or causing significant frustration. It\'s costing you conversions, revenue, or users right now.',
      examples: [
        'Checkout button is hard to find â†’ Users abandon their cart',
        'Form errors don\'t clearly show what\'s wrong â†’ Users give up',
        'No confirmation after payment â†’ Users panic and call support',
        'Critical workflow blocked or severely impaired'
      ],
      timeline: 'âš¡ Fix this week',
      calculation: 'High severity issues are identified based on <strong>critical user impact</strong>, <strong>task blocking</strong>, and <strong>workflow criticality</strong>. Issues in business-critical flows (like checkout or payment) automatically receive higher severity ratings.'
    },
    medium: {
      icon: 'ðŸŸ¡',
      title: 'Medium Severity',
      definition: 'This issue is making your product harder to use than it should be. Users can work around it, but they\'re annoyed. Some less patient users might leave.',
      examples: [
        'Search results are confusing â†’ Users spend extra time finding what they need',
        'Settings are hard to find â†’ Users can\'t customize easily',
        'Navigation labels are unclear â†’ Users click multiple times',
        'Form lacks helpful guidance or real-time validation'
      ],
      timeline: 'ðŸ“… Fix this month',
      calculation: 'Medium severity issues create <strong>noticeable friction</strong> but don\'t block task completion. Severity is adjusted based on workflow type - the same issue in settings gets Medium severity, while in checkout it would be High.'
    },
    low: {
      icon: 'ðŸ”µ',
      title: 'Low Severity',
      definition: 'This is a polish issue. Users can complete all tasks fine, but fixing this would make your product feel more professional or slightly smoother.',
      examples: [
        'Inconsistent button spacing in footer',
        'A label could be clearer but users figure it out',
        'Animation timing feels slightly off',
        'Minor visual inconsistencies that don\'t affect usability'
      ],
      timeline: 'ðŸŽ¨ Fix when you have time',
      calculation: 'Low severity issues are <strong>cosmetic or minor polish items</strong>. They don\'t significantly impact user experience. Issues in low-impact workflows (like help pages) typically receive Low severity ratings unless they block critical tasks.'
    }
  };

  const content = severityContent[severity];
  if (!content) return;

  let workflowContextHTML = '';
  if (workflowCriticality && workflowTitle) {
    const criticalityDescriptions = {
      'Business-Critical': 'Business-Critical workflows (checkout, payment, signup, login) receive the highest severity ratings because issues here directly impact revenue and core business functions.',
      'High-Impact': 'High-Impact workflows (onboarding, core features, search) are essential to user success, so issues receive elevated severity ratings.',
      'Standard': 'Standard workflows (settings, profile, preferences) receive baseline severity ratings since issues here are less likely to block critical tasks.',
      'Low-Impact': 'Low-Impact workflows (help pages, about pages) receive lower severity ratings since these areas are less critical to core user tasks.'
    };

    workflowContextHTML = `
      <div class="workflow-context">
        <strong>Your Workflow:</strong> "${workflowTitle}" was classified as <strong>${workflowCriticality}</strong>.<br>
        ${criticalityDescriptions[workflowCriticality] || ''}
      </div>
    `;
  }

  modalBody.innerHTML = `
    <h2>
      <span class="severity-icon">${content.icon}</span>
      ${content.title}
    </h2>

    <div class="severity-section">
      <h3>What it means</h3>
      <p>${content.definition}</p>
    </div>

    <div class="severity-section">
      <h3>Examples</h3>
      <div class="severity-examples">
        <ul>
          ${content.examples.map(ex => `<li>${ex}</li>`).join('')}
        </ul>
      </div>
    </div>

    <div class="severity-section">
      <h3>When to fix</h3>
      <div class="severity-timeline">${content.timeline}</div>
    </div>

    <div class="severity-section">
      <h3>How it's calculated</h3>
      <div class="severity-calculation">
        ${content.calculation}
      </div>
      ${workflowContextHTML}
    </div>
  `;

  modal.style.display = 'flex';
  document.body.style.overflow = 'hidden';
}

function closeSeverityModal(event) {
  if (event && event.target.classList.contains('severity-modal-content')) {
    return;
  }

  const modal = document.getElementById('severityModal');
  modal.style.display = 'none';
  document.body.style.overflow = '';
}

// Close modal on ESC key
document.addEventListener('keydown', function(event) {
  if (event.key === 'Escape') {
    closeSeverityModal();
  }
});

// EVENT LISTENERS (CSP Compliant)
document.addEventListener('DOMContentLoaded', function() {
  // Severity info icon click handlers
  document.querySelectorAll('.severity-info-icon').forEach(function(button) {
    button.addEventListener('click', function() {
      const severity = this.getAttribute('data-severity');
      openSeverityInfo(severity);
    });
  });

  // Timeline range button click handlers
  document.querySelectorAll('.timeline-range-btn').forEach(function(button) {
    button.addEventListener('click', function() {
      const idx = parseInt(this.getAttribute('data-issue-index'), 10);
      highlightCard(idx);
    });
  });

  // Workflow toggle button click handler
  const workflowToggleBtn = document.getElementById('workflow-toggle-btn');
  if (workflowToggleBtn) {
    workflowToggleBtn.addEventListener('click', toggleWorkflowDetails);
  }

  // Copy and Jira button handlers (disabled for demo)
  document.querySelectorAll('.copy-btn.demo-disabled, .jira-btn.demo-disabled').forEach(function(button) {
    button.addEventListener('click', function() {
      alert('Sign up to unlock Copy and JIRA integration!');
    });
  });

  // Modal close handlers
  const severityModal = document.getElementById('severityModal');
  const modalCloseBtn = document.querySelector('.severity-modal-close');

  if (severityModal) {
    severityModal.addEventListener('click', function(event) {
      if (event.target === severityModal) {
        closeSeverityModal();
      }
    });
  }

  if (modalCloseBtn) {
    modalCloseBtn.addEventListener('click', function() {
      closeSeverityModal();
    });
  }

  const modalContent = document.querySelector('.severity-modal-content');
  if (modalContent) {
    modalContent.addEventListener('click', function(event) {
      event.stopPropagation();
    });
  }

  // Header button handlers
  const filterBtn = document.getElementById('filter-btn');
  if (filterBtn) {
    filterBtn.addEventListener('click', function() {
      alert('Filters coming soon!');
    });
  }

  const exportBtn = document.getElementById('export-btn');
  if (exportBtn) {
    exportBtn.addEventListener('click', function() {
      window.print();
    });
  }
});
</script>
